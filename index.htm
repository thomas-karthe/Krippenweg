<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Krippenweg 2025/26</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    html, body { height:100%; margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif; }
    #map { width:100%; height:100%; }

    /* Sidebar links */
    #overlay {
      position:absolute; top:0; left:0; bottom:0;
      width:min(300px, 70vw);
      background:rgba(255,255,255,0.82);
      box-shadow:4px 0 25px rgba(0,0,0,0.2);
      padding:18px 20px 14px;
      overflow-y:auto;
      transform:translateX(-105%);
      transition:transform .35s ease;
      z-index:1000;
      backdrop-filter:blur(6px) saturate(1.1);
      -webkit-backdrop-filter:blur(6px) saturate(1.1);
    }
    #overlay.visible { transform:translateX(0); }

    /* Toggle-Buttons oben rechts */
    #poiListBtn, #mapBtn {
      position:absolute;
	  height:40px;	
      right:16px;
		
      z-index:1100;
      border:none;
      border-radius:8px;
      cursor:pointer;
      box-shadow:0 2px 8px rgba(0,0,0,0.3);
      transition:background 0.2s ease, transform 0.2s ease;
    }
    #poiListBtn {
      top:16px;		
      background:#993355;
      color:#fff;
      padding:8px 14px;
      font-size:16px;
    }
    #poiListBtn:hover { background:#aa4466; }

    #mapBtn {
      top:60px;
      background:#993355;
      width:40px;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:8px;
    }
    #mapBtn:hover { background:#993355; }
    #mapBtn img { width:24px; height:24px; transition:transform 0.3s ease; }
    #mapBtn:hover img { transform:rotate(10deg); }

    h2 { margin:0 0 10px; font-weight:600; font-size:20px; color:#222; }

    /* Fancy-Liste */
    ol.fancy-list {
      list-style:none;
      counter-reset:item;
      padding:0;
      margin:8px 0 0;
    }
    ol.fancy-list li {
      counter-increment:item;
      margin:10px 0;
      padding-left:48px;
      position:relative;
      cursor:pointer;
      color:#111;
      font-weight:500;
      transition:color .2s ease;
    }
    ol.fancy-list li::before {
      content:counter(item);
      position:absolute;
      left:0; top:50%;
      transform:translateY(-50%);
      background:#993355;
      color:#fff;
      width:30px; height:30px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      font-size:15px;
      box-shadow:0 2px 4px rgba(0,0,0,0.25);
    }
    ol.fancy-list li:hover {
      color:#993355;
      text-decoration:underline;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <button id="mapBtn" title="Kartenstil wechseln">
    <img src="data/images/World4.png" alt="Karte" id="mapIcon">
  </button>
	
  <button id="poiListBtn" title="Liste der Stationen ein- oder ausblenden">‚ò∞ Krippen-Stationen</button>
  <!-- üõà Info-Button mit Tooltip -->
  <div class="tooltip-container" data-tooltip="Informationen anzeigen">
    <button id="infoBtn" title="Informationen anzeigen">üõà</button>
  </div>

  <!-- üìÑ Info-Overlay -->
  <div id="infoOverlay">
    <div class="info-content">
      <button id="closeInfo">√ó</button>
      <h2>√úber den Krippenweg</h2>
      <p>
        Willkommen auf dem Krippenweg!<br>
        Auf dieser interaktiven Karte finden Sie alle Stationen mit kurzen Beschreibungen.<br><br>
        Jede Nummer in der Liste links f√ºhrt Sie direkt zum entsprechenden Ort auf der Karte.
      </p>
      <p>
        <strong>Tipp:</strong> Mit dem üåç-Button wechseln Sie zwischen Kartenstilen.<br>
        Mit ‚ò∞ k√∂nnen Sie die Liste ein- oder ausblenden.
      </p>
    </div>
  </div>
  
  <aside id="overlay">
    <h2>Krippenweg 2025/26</h2>
    <ol id="poi-list" class="fancy-list"></ol>
  </aside>

  <script>
    // === Karte initialisieren ===
    const map = L.map('map', { zoomControl:false, scrollWheelZoom:true, touchZoom:true })
      .setView([48.6279, 8.9965], 15);

    // === Kartenlayer ===
    const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 20, attribution: '&copy; OpenStreetMap'
    });
    const lightLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      maxZoom: 20, attribution: '&copy; OpenStreetMap &copy; CartoDB'
    });
    lightLayer.addTo(map);
    let currentLayer = lightLayer;

    // === Buttons ===
    const overlay = document.getElementById('overlay');
    const poiListBtn = document.getElementById('poiListBtn');
    const mapBtn = document.getElementById('mapBtn');
    const mapIcon = document.getElementById('mapIcon');
    let visible = false;
    poiListBtn.addEventListener('click', () => {
      visible = !visible;
      overlay.classList.toggle('visible', visible);
      poiListBtn.textContent = visible ? '√ó Schlie√üen' : '‚ò∞ Stationen';
    });

    // === Hilfsfunktionen f√ºr KML ===
    const KML_NS = 'http://www.opengis.net/kml/2.2';
    const byTag = (p,t)=>Array.from(p.getElementsByTagNameNS(KML_NS,t));
    const txt = e => e ? e.textContent.trim() : '';
    const resolveHref = href => /^https?:/i.test(href) ? href : ('data/' + href.replace(/^\.?\/*/,''));

    const iconCache = new Map();
    function iconFor(url){
      if (!url) return undefined;
      if (iconCache.has(url)) return iconCache.get(url);
      const ic = L.icon({ iconUrl:url, iconSize:[32,32], iconAnchor:[16,32], popupAnchor:[0,-28] });
      iconCache.set(url, ic); return ic;
    }

    function collectIcons(xml){
      const styles = new Map();
      byTag(xml,'Style').forEach(s=>{
        const id = s.getAttribute('id');
																	
        const href = s.getElementsByTagName('href')[0];
        if (id && href) styles.set('#'+id, resolveHref(txt(href)));
      });
      byTag(xml,'StyleMap').forEach(sm=>{
        const id = sm.getAttribute('id'); if (!id) return;
        const pairs = byTag(sm,'Pair');
        let resolved=null;
        for(const key of ['normal','highlight']){
          const p = pairs.find(px => txt(byTag(px,'key')[0])===key);
          const su = p && txt(byTag(p,'styleUrl')[0]);
          if (su && styles.has(su)) { resolved = styles.get(su); break; }
        }
        if (resolved) styles.set('#'+id, resolved);
      });
      return styles;
    }

    const markers = [];

    // === KML laden ===
    fetch('data/krippenweg.kml')
      .then(r => r.text())
      .then(kmlText => {
        const xml = new DOMParser().parseFromString(kmlText, 'application/xml');
														  
															

        const styles = collectIcons(xml);
        const list = document.getElementById('poi-list');
        const placemarks = byTag(xml,'Placemark');
						   

        placemarks.forEach((pm, idx) => {
          const pt = byTag(pm,'Point')[0];
          if (!pt) return;
          const coordsNode = byTag(pt,'coordinates')[0];
          if (!coordsNode) return;

          const [lon, lat] = txt(coordsNode).split(',').map(parseFloat);
														
																	 
																   
          if (!isFinite(lat) || !isFinite(lon)) return;

          const name = txt(byTag(pm,'name')[0]) || `Station ${idx+1}`;
          const desc = `Station ${idx+1}`;
          const styleUrl = txt(byTag(pm,'styleUrl')[0]);
          const iconHref = styleUrl ? styles.get(styleUrl) : null;

          const marker = L.marker([lat, lon], { icon: iconFor(iconHref) })
            .addTo(map)
            .bindPopup(`<strong>${name}</strong>${desc ? '<br>'+desc : ''}`);
          markers.push(marker);

          const li = document.createElement('li');
          li.textContent = name;
          li.title = `${lat.toFixed(6)}, ${lon.toFixed(6)}`;
          li.addEventListener('click', () => {
            overlay.classList.remove('visible');
            poiListBtn.textContent = '‚ò∞ Stationen'; visible = false;
            map.flyTo([lat, lon], 18, { animate:true, duration:0.9 });
            marker.openPopup();
          });
          list.appendChild(li);
        });

							 
        if (markers.length) map.fitBounds(L.featureGroup(markers).getBounds().pad(0.15));
				
																				  
		 
      })
      .catch(err => {
        console.error('KML-Fehler:', err);
        alert('KML konnte nicht geladen/geparst werden. Pr√ºfe Pfad: data/krippenweg.kml');
      });

    // === "Karte"-Button: Ansicht + Stil wechseln ===
    mapBtn.addEventListener('click', () => {
      // Ansicht zur√ºcksetzen
      if (markers.length) {
        map.closePopup();
        map.flyToBounds(L.featureGroup(markers).getBounds().pad(0.15), { animate:true, duration:0.8 });
      }

      // Kartenstil wechseln
      if (currentLayer === lightLayer) {
        map.removeLayer(lightLayer);
        osmLayer.addTo(map);
        currentLayer = osmLayer;
        mapIcon.src = 'data/images/World3.png';
      } else {
        map.removeLayer(osmLayer);
        lightLayer.addTo(map);
        currentLayer = lightLayer;
        mapIcon.src = 'data/images/World4.png';
      }
    });
  </script>
</body>
</html>





















