<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Krippenweg â€“ Karte</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<!-- KML -> GeoJSON Konverter -->
<script src="https://unpkg.com/@tmcw/togeojson@5.8.0/dist/togeojson.umd.js"></script>

<style>
  html,body{height:100%;margin:0}
  #map{height:100%;width:100%}
  .leaflet-popup-content p{margin:.5em 0}
  .btn{position:absolute;z-index:9999;top:10px;left:10px;background:#fff;
       border:1px solid #ccc;padding:.4rem .8rem;border-radius:8px;cursor:pointer}
</style>
</head>
<body>
<button class="btn" id="btn-full">Vollbild</button>
<div id="map"></div>

<script>
const map = L.map('map');
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 20,
  attribution:'&copy; <a href="https://www.openstreetmap.org/">OSM</a>'
}).addTo(map);

// KML laden
async function loadKml(url){
  const res = await fetch(url);
  const text = await res.text();
  const dom = new DOMParser().parseFromString(text,"text/xml");
  const gj = toGeoJSON.kml(dom);
  const layer = L.geoJSON(gj,{
    pointToLayer:(f,latlng)=>L.marker(latlng),
    onEachFeature:(f,l)=>{
      const p=f.properties||{},title=p.name||"Station";
      const desc=p.description||"";
      const html=`<strong>${title}</strong><p>${desc}</p>`;
      l.bindPopup(html);
    },
    style:()=>({color:"#0a7",weight:3})
  }).addTo(map);
  map.fitBounds(layer.getBounds(),{padding:[20,20]});
}
loadKml("data/krippenweg.kml");

// Einfacher Vollbild-Button (funktioniert auf iOS)
document.getElementById("btn-full").onclick=()=>{
  const el=document.getElementById("map");
  if(!document.fullscreenElement){
    (el.requestFullscreen||el.webkitRequestFullscreen||(()=>{el.style.position="fixed";el.style.inset="0";}))();
  }else{
    (document.exitFullscreen||document.webkitExitFullscreen||(()=>{el.removeAttribute("style");}))();
  }
};
</script>
</body>
</html>
